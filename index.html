<!DOCTYPE 
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR 數位名片</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>

    <style>
      /* UI 按鈕樣式設定 */
      .buttons {
        position: absolute;
        bottom: 20px;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        z-index: 10;
        pointer-events: none;
      }
      button {
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        border-radius: 8px;
        border: none;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        margin: 0 10px;
        cursor: pointer;
        pointer-events: auto;
        transition: background 0.2s;
      }
      button:active {
        background: rgba(200, 200, 200, 1);
      }
    </style>

    <script>
      // 定義切換顯示平面圖片的函式
      window.showImage = function() {
        const plane = document.querySelector('#display-plane');
        const model = document.querySelector('#display-model');
        
        // 隱藏 3D 模型
        if(model) model.setAttribute('visible', false);
        
        // 顯示平面並重新觸發動畫
        if(plane) {
          plane.setAttribute('visible', true);
          plane.emit('playScale');
          // 加上微小延遲確保動畫系統順利銜接漂浮效果
          setTimeout(() => plane.emit('playFloat'), 100); 
        }
      };

      // 定義切換顯示 3D 模型的函式
      window.show3D = function() {
        const plane = document.querySelector('#display-plane');
        const model = document.querySelector('#display-model');
        
        // 隱藏平面圖片
        if(plane) plane.setAttribute('visible', false);
        
        // 顯示 3D 模型並確保比例正確
        if(model) {
          model.setAttribute('visible', true);
          model.setAttribute('scale', '0.5 0.5 0.5'); 
        }
      };

      // 註冊 Marker 掃描事件監聽器
      AFRAME.registerComponent('marker-handler', {
        init: function () {
          this.el.addEventListener('markerFound', () => {
            // 掃描到 Marker 時，預設觸發顯示圖片與動畫
            window.showImage();
          });
        }
      });
    </script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div class="buttons">
      <button onclick="window.showImage()">顯示名片</button>
      <button onclick="window.show3D()">顯示 3D</button>
    </div>

    <a-scene 
      embedded 
      arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;"
      renderer="logarithmicDepthBuffer: true; colorManagement: true;"
      vr-mode-ui="enabled: false">
      
      <a-assets>
        <img id="card-img" src="assets/my-card.jpg">
        <a-asset-item id="robot-model" src="assets/robot.glb"></a-asset-item>
      </a-assets>

      <a-marker marker-handler type="pattern" url="assets/pattern-qr.ioi.tw.patt" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
        
        <a-plane id="display-plane" 
                 src="#card-img" 
                 position="0 0.1 0" 
                 rotation="-90 0 0" 
                 width="1.5" 
                 height="1"
                 visible="false"
                 animation__scale="property: scale; from: 0 0 0; to: 1 1 1; dur: 1000; easing: easeOutElastic; startEvents: playScale"
                 animation__float="property: position; from: 0 0.1 0; to: 0 0.3 0; dir: alternate; dur: 1000; loop: true; startEvents: playFloat">
        </a-plane>

        <a-entity id="display-model" 
                  gltf-model="#robot-model" 
                  scale="0.5 0.5 0.5" 
                  position="0 0 0"
                  visible="false"
                  animation-mixer>
        </a-entity>

      </a-marker>

      <a-light type="ambient" color="#ffffff" intensity="1.5"></a-light>
      <a-entity camera></a-entity>
      
    </a-scene>
  </body>
</html>